#Read CSV into R
mydata <- read.csv(file="/Users/tianshan/Desktop/10minswalk.csv", header=TRUE, sep=",")
dim(mydata)

#select varaibles
group1 <- cbind.data.frame(mydata["latitude"],mydata["longitude"],mydata["price_per_sqm"], mydata["apartment"], mydata["number_of_half_rooms"], mydata["number_of_whole_rooms"], mydata["floor"])
print("group I: apartment, number_of_half_rooms, number_of_whole_rooms, floor")
dim(group1)
#Drop NA
group1clean <- na.omit(group1)
dim(group1clean)
head(group1clean)

#Basic OLS
f1 <- price_per_sqm ~ apartment + number_of_half_rooms + number_of_whole_rooms + floor
m1 <- lm(f1, data = group1clean)
summary(m1)

#spatial lag regression
group1clean$residuals <- residuals(m1)
print(group1clean$residuals)

library(spdep)
coord <- cbind(group1clean$latitude, group1clean$longitude)
head(coord)
knea <- knearneigh(coord, longlat = TRUE)
nb <- knn2nb(knea)
lw <- nb2listw(nb)
moran.mc(group1clean$residuals, lw, 999)
m1slag = lagsarlm(f1, data = group1clean, lw, tol.solve = 1.0e-30)
summary(m1s)
